<span class="text-white font-black text-xl">
    Live Pack Price: <span id="live-market-price" class="text-white">Loading...</span> 
    <span class="text-yellow-400 ml-4">â˜… $vbfx Balance: <span id="balance">0</span></span>
</span>

<script>
    const MARKET_URL = "https://vibechain.com/market/vibe-fx";
    const PROXY_URL = "https://api.allorigins.win/get?url="; // Bypasses CORS to let us read the page

    async function fetchLivePrice() {
        try {
            const response = await fetch(`${PROXY_URL}${encodeURIComponent(MARKET_URL)}`);
            const data = await response.json();
            
            // We create a temporary hidden element to parse the HTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(data.contents, 'text/html');

            // This looks for common price patterns on VibeChain (usually in a specific div or span)
            // Note: If VibeChain changes their layout, we just update the selector below.
            const priceElement = doc.querySelector('.text-2xl.font-bold') || 
                               doc.querySelector('[class*="price"]') || 
                               doc.querySelector('.font-black.text-white');

            if (priceElement) {
                const rawPrice = priceElement.innerText.trim();
                document.getElementById('live-market-price').innerText = rawPrice;
            } else {
                document.getElementById('live-market-price').innerText = "Check Market";
            }
        } catch (error) {
            console.error("Failed to fetch price:", error);
            document.getElementById('live-market-price').innerText = "Market Offline";
        }
    }

    // Connect Wallet and Balance Logic (Already matches your provided addresses)
    async function init() {
        if (!window.ethereum) return alert("Install MetaMask");
        const provider = new ethers.BrowserProvider(window.ethereum);
        const accounts = await provider.send("eth_requestAccounts", []);
        const address = accounts[0];
        
        document.getElementById('connectBtn').innerText = address.slice(0,6) + "..." + address.slice(-4);

        // $VBFX Balance from 0x30d24fc619f59f6f267ee884d802288e124b17c1
        const erc20Abi = ["function balanceOf(address) view returns (uint256)", "function decimals() view returns (uint8)"];
        const tokenContract = new ethers.Contract("0x30d24fc619f59f6f267ee884d802288e124b17c1", erc20Abi, provider);
        const balance = await tokenContract.balanceOf(address);
        const decimals = await tokenContract.decimals();
        document.getElementById('balance').innerText = parseFloat(ethers.formatUnits(balance, decimals)).toLocaleString();

        // NFT Check for Bounty from 0xc7f2d8c035b2505f30a5417c0374ac0299d88553
        const nftContract = new ethers.Contract("0xc7f2d8c035b2505f30a5417c0374ac0299d88553", ["function balanceOf(address) view returns (uint256)"], provider);
        const nftBalance = await nftContract.balanceOf(address);
        if (nftBalance > 0n) {
            document.getElementById('bountyCard').classList.remove('bounty-locked');
            document.getElementById('bountyStatus').innerText = "UNLOCKED";
            document.getElementById('bountyStatus').style.backgroundColor = "#b4ff39";
            document.getElementById('bountyStatus').style.color = "#000";
        }
    }

    // Run on Load
    document.getElementById('connectBtn').onclick = init;
    fetchLivePrice();
    setInterval(fetchLivePrice, 60000); // Refresh price every 60 seconds
</script>
